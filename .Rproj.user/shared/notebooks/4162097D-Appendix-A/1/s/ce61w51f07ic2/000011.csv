"0","# only intersection, not union!"
"0","deseq_genus_smoking_list_df <- readRDS(""../results/Q1/1.3_differential abundance/Q1.3_Diff_Abund_smoking_results_as.data.frames.rds"") "
"0",""
"0","signif_genera <- deseq_genus_smoking_list_df[1:2] %>% "
"0","  lapply(function(i) filter(i, padj < 0.05) %>% .$Genus)"
"0",""
"0","intersect_signif_genera <- Reduce(intersect, signif_genera)"
"0",""
"0","q1_results <- deseq_genus_smoking_list_df[1:2] %>%"
"0","  lapply(filter, Genus %in% intersect_signif_genera,) %>%"
"0","  bind_rows(.id = ""Contrast"") %>% "
"0","  group_by(Genus) %>% "
"0","  summarise(Q1_log2FC = mean(log2FoldChange))"
"0",""
"0","q2_results <- readRDS(""../results/Q2/genus/DESeq2_regression/deseq_smoking_Q2_datafames.rds"") %>% "
"0","  .$current_tobacco_g_per_day_bin5cont %>% "
"0","  as.data.frame() %>% "
"0","  filter(padj < 0.05)"
"0",""
"0","data_for_plot <- merge(q1_results, q2_results, by = ""Genus"")"
"0",""
"0",""
"0","############# actual plot and significance "
"0","library(RColorBrewer)"
"0","pearson_rho <- cor.test(data_for_plot$Q1_log2FC, data_for_plot$log2FoldChange)"
"0",""
"0","fig.S5 <- data_for_plot %>%"
"0","  "
"0","  ggplot(aes(x = log2FoldChange, y = Q1_log2FC, color = Phylum, shape = Phylum))+"
"0","  geom_point(size = 2)+"
"0","  geom_hline(yintercept = 0, lty = ""dashed"", color = ""darkgray"")+"
"0","  geom_vline(xintercept = 0, lty = ""dashed"", color = ""darkgray"")+"
"0","  labs("
"0","       x = ""Eff. Sizes Smokers vs Non-Smokers"", "
"0","       y = ""Eff. Sizes Daily Dosage (Current smokers only)"","
"0","       subtitle = paste(""Pearson's rho:"", round(pearson_rho$estimate, 3), ""| P-value:"", format(pearson_rho$p.value, scientific = TRUE, digits = 2)))+"
"0","  scale_color_brewer(palette = ""Dark2"")"
"0",""
"0","ggsave(plot = fig.S5,"
"0","       filename = ""../results/Figures/latest_figure_panels/supplementary figures/S5_correl. effect sizes.png"", "
"0","       height = 4, "
"0","       width = 6, "
"0","       dpi = 300, "
"0","       units = ""in"") "
